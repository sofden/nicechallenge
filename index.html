<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Insta-Challenge</title>
  <style>
    :root { --bg:#0b0c10; --card:#151821; --text:#e8ecf1; --muted:#9aa3af; --accent:#4fd1c5; }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; background:var(--bg); color:var(--text); }
    .wrap { max-width:880px; margin:40px auto; padding:0 16px; }
    .card { background:var(--card); border-radius:16px; padding:20px; box-shadow:0 6px 24px rgba(0,0,0,.25); }
    h2,h3,h4 { margin:0 0 12px; }
    hr { border:0; height:1px; background:#232734; margin:16px 0; }
    input[type="text"], input[type="number"]{
      background:#0f1320; color:var(--text); border:1px solid #2a3042; border-radius:10px;
      padding:10px 12px; outline:none; width:260px; max-width:100%;
    }
    input[type="number"]{ width:200px; }
    button{
      background:var(--accent); color:#062e2b; border:0; border-radius:12px; padding:10px 14px;
      cursor:pointer; font-weight:600; transition:transform .05s ease; margin-left:8px;
    }
    button:active{ transform:translateY(1px); }
    ul{ padding-left:18px; }
    .row{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin:8px 0; }
    .pill{ display:inline-block; padding:6px 10px; background:#0f1320; border:1px solid #2a3042; border-radius:999px; margin:4px 6px 0 0; }
    .muted{ color:var(--muted); }
    .winner{ color:#a6e3a1; font-weight:700; }
    .danger{ color:#f38ba8; font-weight:700; }
    .footer-note{ font-size:12px; color:var(--muted); margin-top:8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2>Insta-Challenge</h2>
      <p class="muted">–ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤–≤–æ–¥—è—Ç –º–∏–Ω—É—Ç—ã –∏–∑ Instagram. –ú–∏–Ω–∏–º—É–º –∑–∞ –¥–µ–Ω—å ‚Äî –ø–æ–ª—É—á–∞–µ—Ç +1 –±–∞–ª–ª. –í –∫–æ–Ω—Ü–µ —Å—á–∏—Ç–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∏ –≤—ã–ø–ª–∞—Ç—ã.</p>

      <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
      <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
      <div class="row">
        <input type="text" id="newPlayer" placeholder="–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞" />
        <button onclick="addPlayer()">–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</button>
        <button onclick="resetAll()" title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
      <div id="playerList" class="row"></div>

      <hr>

      <!-- –í–≤–æ–¥ –º–∏–Ω—É—Ç –∑–∞ –¥–µ–Ω—å -->
      <h3>–î–Ω–∏ –∏ –º–∏–Ω—É—Ç—ã</h3>
      <div class="row">
        <button onclick="addDay()">–°–æ–∑–¥–∞—Ç—å –¥–µ–Ω—å</button>
        <span class="footer-note">–ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –º–∏–Ω—É—Ç –Ω–∞–∂–º–∏ ¬´–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–µ–Ω—å¬ª.</span>
      </div>
      <div id="dayInputs"></div>

      <hr>

      <!-- –¢–µ–∫—É—â–∏–π —Å—á—ë—Ç -->
      <h3>–¢–µ–∫—É—â–∏–µ –±–∞–ª–ª—ã</h3>
      <div id="scoreList" class="row muted"></div>

      <hr>

      <div class="row">
        <button onclick="finishChallenge()">–ó–∞–∫–æ–Ω—á–∏—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂</button>
      </div>
      <div id="finalResult" style="margin-top:12px;"></div>
    </div>
  </div>

  <script>
    let players = []; // {name: string, score: number}
    let days = [];    // –∫–∞–∂–¥—ã–π –¥–µ–Ω—å: { playerName: minutes }

    function addPlayer() {
      const el = document.getElementById('newPlayer');
      const name = el.value.trim();
      if (!name) return;
      if (players.find(p => p.name === name)) { alert("–¢–∞–∫–æ–π —É—á–∞—Å—Ç–Ω–∏–∫ —É–∂–µ –µ—Å—Ç—å"); return; }
      players.push({ name, score: 0 });
      updatePlayerList();
      updateScoreList();
      el.value = '';
    }

    function resetAll() {
      if (!confirm("–¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –¥–Ω–∏ –∏ –±–∞–ª–ª—ã?")) return;
      players = [];
      days = [];
      document.getElementById('playerList').innerHTML = '';
      document.getElementById('dayInputs').innerHTML = '';
      document.getElementById('scoreList').innerHTML = '';
      document.getElementById('finalResult').innerHTML = '';
    }

    function updatePlayerList() {
      const box = document.getElementById('playerList');
      box.innerHTML = '';
      players.forEach(p => {
        const span = document.createElement('span');
        span.className = 'pill';
        span.textContent = p.name;
        box.appendChild(span);
      });
    }

    function addDay() {
      if (players.length === 0) { alert("–î–æ–±–∞–≤—å—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤"); return; }

      const dayDiv = document.createElement('div');
      const dayIndex = days.length;
      dayDiv.id = 'day' + dayIndex;
      dayDiv.style.margin = '14px 0';
      dayDiv.innerHTML = `<h4 style="margin:0 0 8px">–î–µ–Ω—å ${dayIndex + 1}</h4>`;

      players.forEach(p => {
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <label style="min-width:160px">${p.name}</label>
          <input type="number" min="0" placeholder="–º–∏–Ω—É—Ç—ã" id="day${dayIndex}_player_${p.name}">
        `;
        dayDiv.appendChild(row);
      });

      const actions = document.createElement('div');
      actions.className = 'row';
      const submitBtn = document.createElement('button');
      submitBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–µ–Ω—å';
      submitBtn.onclick = () => submitDay(dayIndex);
      actions.appendChild(submitBtn);
      dayDiv.appendChild(actions);

      document.getElementById('dayInputs').appendChild(dayDiv);
    }

    function submitDay(dayIndex) {
      let dayData = {};
      let allFilled = true;

      players.forEach(p => {
        const field = document.getElementById(`day${dayIndex}_player_${p.name}`);
        const val = parseInt(field.value, 10);
        if (isNaN(val)) allFilled = false;
        dayData[p.name] = val;
      });

      if (!allFilled) { alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è"); return; }

      days.push(dayData);

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –¥–Ω—è (–º–∏–Ω–∏–º—É–º –º–∏–Ω—É—Ç)
      const minMinutes = Math.min(...Object.values(dayData));
      const winners = Object.entries(dayData)
        .filter(([_, mins]) => mins === minMinutes)
        .map(([name]) => name);

      // –ù–∞—á–∏—Å–ª—è–µ–º +1 –±–∞–ª–ª –∫–∞–∂–¥–æ–º—É –ø–æ–±–µ–¥–∏—Ç–µ–ª—é –¥–Ω—è
      winners.forEach(name => {
        const pl = players.find(p => p.name === name);
        if (pl) pl.score += 1;
      });

      alert(winners.length === 1
        ? `–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –¥–Ω—è: ${winners[0]}`
        : `–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –¥–Ω—è: ${winners.join(', ')}`);

      updateScoreList();

      // –õ–æ—á–∏–º –ø–æ–ª—è –¥–Ω—è
      document.querySelectorAll(`#day${dayIndex} input, #day${dayIndex} button`).forEach(el => el.disabled = true);
    }

    function updateScoreList() {
      const box = document.getElementById('scoreList');
      box.innerHTML = '';
      players
        .slice()
        .sort((a,b)=> b.score - a.score || a.name.localeCompare(b.name))
        .forEach(p => {
          const span = document.createElement('span');
          span.className = 'pill';
          span.textContent = `${p.name}: ${p.score}`;
          box.appendChild(span);
        });
    }

    function finishChallenge() {
      if (players.length === 0) return;

      const maxScore = Math.max(...players.map(p => p.score));
      const top = players.filter(p => p.score === maxScore);
      const winnerNames = top.map(p => p.name).join(', ');

      // –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π ‚Äî –æ–±—ä—è–≤–∏–º –æ–±—â—É—é –ø–æ–±–µ–¥—É –∏ –≤—ã—Å—Ç–∞–≤–∏–º —Å—É–º–º–∞—Ä–Ω—ã–π –ø—Ä–∏–∑ –Ω–∞ –∫–∞–∂–¥–æ–≥–æ (–ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å)
      const winner = top[0]; // –±–µ—Ä—ë–º –ø–µ—Ä–≤–æ–≥–æ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ø—Ä–∏–∑–∞ –ø–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–º—É –ø—Ä–∞–≤–∏–ª—É
      const prize = winner.score * 100;

      const losers = players.filter(p => !top.includes(p));
      let html = `<h3>–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h3>`;

      if (top.length === 1) {
        html += `<p>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: <span class="winner">${winner.name}</span> ‚Äî ${winner.score} –±–∞–ª–ª–æ–≤. –ü—Ä–∏–∑: <b>${prize} ‚ÇΩ</b></p>`;
      } else {
        html += `<p>–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏: <span class="winner">${winnerNames}</span> ‚Äî –ø–æ ${maxScore} –±–∞–ª–ª–æ–≤.</p>`;
        html += `<p class="muted">–î–ª—è —Ä–∞—Å—á—ë—Ç–∞ –≤—ã–ø–ª–∞—Ç –Ω–∏–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–∑, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –ø–æ –ø–µ—Ä–≤–æ–º—É –ø–æ–±–µ–¥–∏—Ç–µ–ª—é: <b>${prize} ‚ÇΩ</b> (–º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ).</p>`;
      }

      if (losers.length === 0) {
        html += `<p class="muted">–ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö –Ω–µ—Ç ‚Äî –Ω–∏–∫—Ç–æ –Ω–µ –ø–ª–∞—Ç–∏—Ç üôÇ</p>`;
        document.getElementById('finalResult').innerHTML = html;
        return;
      }

      // –û–±—Ä–∞—Ç–Ω–∞—è –ø—Ä–æ–ø–æ—Ä—Ü–∏—è: —á–µ–º –º–µ–Ω—å—à–µ –±–∞–ª–ª–æ–≤, —Ç–µ–º –±–æ–ª—å—à–µ –ø–ª–∞—Ç—ë–∂ (–≤–µ—Å = 1 / score; –µ—Å–ª–∏ 0 ‚Üí –≤–µ—Å = 1)
      const weights = losers.map(p => 1 / (p.score || 1));
      const sumW = weights.reduce((a,b)=>a+b, 0);

      html += `<h4>–í—ã–ø–ª–∞—Ç—ã –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö</h4><ul>`;
      losers.forEach((p, i) => {
        const pay = Math.round(prize * (weights[i] / sumW));
        html += `<li><span class="danger">${p.name}</span> –ø–ª–∞—Ç–∏—Ç: <b>${pay} ‚ÇΩ</b> (–±–∞–ª–ª—ã: ${p.score})</li>`;
      });
      html += `</ul>`;

      document.getElementById('finalResult').innerHTML = html;
    }
  </script>
</body>
</html>
